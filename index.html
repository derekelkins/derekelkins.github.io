<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="A blog mostly on math, physics, and computer science.">
    <meta name="author" content="Derek Elkins">
    <!--<link rel="icon" href="/images/favicon.ico">-->

    <title>Home</title>
    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="./css/blog.css" rel="stylesheet">
    <link href="./css/syntax.css" rel="stylesheet">
  </head>

  <body>
    <div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item active" href="./">Home</a>
          <a class="blog-nav-item " href="./about.html">About</a>
          <a class="blog-nav-item " href="./contact.html">Contact</a>
          <a class="blog-nav-item " href="./readinglist.html">Reading List</a>
          <a class="blog-nav-item " href="./archive.html">Archive</a>
          <a class="blog-nav-item pull-right" href="./rss.xml">RSS</a>
          <a class="blog-nav-item pull-right" href="./atom.xml">Atom</a>
        </nav>
      </div>
    </div>

    <div class="container">
      
          <div class="blog-header">
            <a href="./"><h1 class="blog-title">Hedonistic Learning</h1></a>
            <p class="lead blog-description">Learning for the fun of it</p>
          </div>
      
      <div class="row">
        
        <div class="col-sm-8 blog-main">
        
          
    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/finite.html">Finite</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="0b86a098-b8c4-47aa-bc63-ef7cfa0681cf" href="./posts/finite.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h3 id="introduction">Introduction</h3>
<p>When sets are first introduced to students, usually examples are used with finite, explicitly presented sets. For example, #{1,2,3} uu {2,3,4} = {1,2,3,4}#. This is the beginning of the idea that a set is a “collection” of things. Later, when infinite sets are introduced, the idea that sets are “collections” of things is still commonly used as the intuitive basis for the definitions. While I personally find this a bit of a philosophical bait-and-switch, my main issue with it is that I don’t think it does a good job reflecting how we work with sets day-to-day nor for more in-depth set-theoretic investigations. Instead, I recommend thinking about infinite sets as defined by properties and #x in X# for some infinite set #X# means checking whether it satisfies the property defining #X#, <em>not</em> rummaging through the infinite elements that make up #X# and seeing if #x# is amongst them. This perspective closely reflects how we prove things about infinite sets. It makes it much clearer that the job is to find logical relationships between the properties that define sets.</p>
<p>Of course, this view can also be applied to finite sets and <em>should</em> be applied to them. For a constructivist, the notion of “finite set” splits into multiple inequivalent notions, and it is quite easy to show that there is a subset of #{0,1}# which is not “finite” with respect to strong notions of “finite” that are commonly used by constructivists. Today, though, I’ll stick with classical logic and classical set theory. In particular, I’m going to talk about the <a href="https://en.wikipedia.org/wiki/Internal_set_theory">Internal Set Theory</a> of Edward Nelson, or mostly the small fragment he used in <a href="https://web.math.princeton.edu/~nelson/books/rept.pdf">Radically Elementary Probability Theory</a>. In the <a href="https://web.math.princeton.edu/~nelson/books/1.pdf">first chapter of an unfinished book on Internal Set Theory</a>, he states the following:</p>
<blockquote>
<p>Perhaps it is fair to say that “finite” does not mean what we have always thought it to mean. What have we always thought it to mean? I used to think that I knew what I had always thought it to mean, but I no longer think so.</p>
</blockquote>
<p>While it may be a bit strong to say that Internal Set Theory leads to some question about what “finite” means, I think it makes a good case for questioning what “finite set” means. These concerns are similar to the relativity of the notion of “(un)countable set”.</p>

            <h6><a href="./posts/finite.html">Read more...</a></h6>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            March 26, 2018 07:57 UTC
            
            (Last updated on May 29, 2018 03:03 UTC)

            
                Tags: <a href="./tags/math.html">math</a>, <a href="./tags/logic.html">logic</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/the-pedagogy-of-logic-a-rant.html">The Pedagogy of Logic: A Rant</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="5c9fe83f-9bc9-4523-9353-e3456a5a1795" href="./posts/the-pedagogy-of-logic-a-rant.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h3 id="introduction">Introduction</h3>
<p>Over the years I’ve seen a lot of confusion about formal logic online. Usually this is from students (but I’ve also seen it with experienced mathematicians) on platforms like the Math or CS StackExchange. Now there is clearly some selection bias where the people asking the questions are the people who are confused, but while the questions <em>about</em> the confusions are common, the confusions are often evident even in questions about other aspects, the confusions are <em>in the (upvoted!) answers</em>, and when you look at the study material they are using it is often completely unsurprising that they are confused. Again, these confusions are also not limited to just “students”, though I’ll use that word in a broad sense below. Finally, on at least one of the points below, the confusion seems to be entirely on the instructors’ side.</p>
<p>To give an indication of the problem, here is my strong impression of what would happen if I gave a student who had just passed a full year introduction to formal logic the following exercise: “Give me a formal proof of #(neg P =&gt; neg Q) =&gt; (Q =&gt; P)#”. I suspect most would draw up a truth table. When I responded, “that’s not a formal proof,” they would be confused. If you are confused by that response, then this is definitely for you. I’m sure they would completely agree with me that if I asked for the inverse matrix of some matrix #M#, showing that the determinant of #M# is non-zero does not constitute an answer to that question. The parallelism of these scenarios would likely be lost on them though. While I think courses that focus on a syntactic approach to logic will produce students that are much more likely to give an appropriate answer to my exercise, that doesn’t mean they lack the confusions, just that this exercise isn’t a good discriminator for them. For example, if they don’t see the parallelism of the two scenarios I described, or worse, have no idea what truth tables have to do with anything, then they have some gap.</p>
<p>As a disclaimer, I am not an educator nor even an academic in any professional capacity.</p>
<p>As a summary, the points I will touch on are:</p>
<ul>
<li><a href="#syntax-versus-semantics">Not <em>continually</em> emphasizing the distinction between syntax and semantics</a>.</li>
<li><a href="#unnecessary-philosophizing">Unnecessary philosophizing</a>.</li>
<li><a href="#the-complete-absence-of-non-classical-logics">The complete absence of non-classical logics</a>.</li>
<li><a href="#silly-linguistics">Silly linguistics exercises</a>.</li>
<li><a href="#the-complete-conflation-of-negation-introduction-with-double-negation-elimination">The complete conflation of negation introduction with double negation elimination</a>.</li>
<li><a href="#overuse-of-indirect-proof">Overuse of indirect proof</a>.</li>
<li><a href="#smaller-issues">Some smaller issues that are not so bad and some missed opportunities</a>.</li>
</ul>
<p>If anyone reading this is aware of <em>introductory</em> textbooks or other resources (ideally freely available, but I’ll take a reasonably priced textbook too) that avoid most or all of the major issues I list and otherwise do a good job, I would be very interested. My own education on these topics has been piecemeal and eclectic and also strongly dependent on my background in programming. This leaves me with no reasonable recommendations. Please leave a comment or email me, if you have such a recommendation.</p>

            <h6><a href="./posts/the-pedagogy-of-logic-a-rant.html">Read more...</a></h6>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            March  1, 2018 04:35 UTC
            
            (Last updated on April 23, 2018 22:53 UTC)

            
                Tags: <a href="./tags/math.html">math</a>, <a href="./tags/logic.html">logic</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/djinn.html">Djinn in your browser</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="83a60c76-d78b-4fb4-8bfc-f21d55a2e378" href="./posts/djinn.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <p>I couldn’t find an online version of Djinn, so I ran it through GHCJS with some tweaks, added a basic interface and hosted it <a href="./djinn/">here</a>. It runs in your browser, so go crazy. If you want changes to the default settings or environment, feel free to suggest them. Right now everything is the default settings of the Djinn tool except that multiple results is enabled.</p>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            April  9, 2017 12:35 UTC
            
            (Last updated on April  9, 2017 12:39 UTC)

            
                Tags: 
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/category-theory-syntactically.html">Category Theory, Syntactically</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="5E75F45D-41BB-4B55-B0ED-BF6D46230139" href="./posts/category-theory-syntactically.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h4 id="or-how-model-theory-got-scooped-by-category-theory">(or: How Model Theory Got Scooped by Category Theory)</h4>
<h2 id="overview">Overview</h2>
<p>This will be a <em>very</em> non-traditional introduction to the ideas behind category theory. It will essentially be a slice through model theory (presented in a more programmer-friendly manner) with an unusual organization. Of course the end result will be <strong>***SPOILER ALERT***</strong> it was category theory all along. A secret decoder ring will be provided at the end. This approach is inspired by the notion of an internal logic/language and by Vaughn Pratt’s paper <a href="http://boole.stanford.edu/pub/yon.pdf">The Yoneda Lemma Without Category Theory</a>. <!-- \* --></p>
<p>I want to be very clear, though. This is not meant to be an analogy or an example or a guide for intuition. This <em>is</em> category theory. It is simply presented in a different manner.</p>
<p>Dan Doel pointed me at some draft lecture notes by Mike Shulman that seem very much in the spirit of this blog post (albeit aimed at an audience familiar with category theory): <a href="https://mikeshulman.github.io/catlog/catlog.pdf">Categorical Logic from a Categorical Point of View</a>. A theory in my sense corresponds to a category presentation (Definition 1.7.1) as defined by these lecture notes. Its oft-mentioned Appendix A will also look very familiar.</p>

            <h6><a href="./posts/category-theory-syntactically.html">Read more...</a></h6>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            November 25, 2016 06:23 UTC
            
            (Last updated on May 26, 2017 11:02 UTC)

            
                Tags: <a href="./tags/programming.html">programming</a>, <a href="./tags/math.html">math</a>, <a href="./tags/category%20theory.html">category theory</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/find-first-set.html">Constant-time Binary Logarithm</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="c90916eb-ab11-4a1f-a1cf-ee18952fffef" href="./posts/find-first-set.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h2 id="introduction">Introduction</h2>
<p>I’ve been watching the <a href="https://courses.csail.mit.edu/6.851/spring14/lectures/">Spring 2012 lectures for MIT 6.851 Advanced Data Structures</a> with Prof. Erik Demaine. In lecture 12, “Fusion Trees”, it mentions a constant time algorithm for finding the index of the first most significant 1 bit in a word, i.e. the binary logarithm. Assuming word operations are constant time, i.e. in the Word RAM model, the below algorithm takes 27 word operations (not counting copying). When I compiled it with GHC 8.0.1 -O2 the core of the algorithm was 44 straight-line instructions. The theoretically interesting thing is, other than changing the constants, the same algorithm works for any word size that’s an even power of 2. Odd powers of two need a slight tweak. This is demonstrated for <code>Word64</code>, <code>Word32</code>, and <code>Word16</code>. It should be possible to do this for any arbitrary word size <code>w</code>.</p>
<p>The <code>clz</code> instruction <a href="https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Bits.html#v:countLeadingZeros">can be used to implement</a> this function, but this is a potential simulation if that or a similar instruction wasn’t available. It’s probably not the fastest way. Similarly, find first set and count trailing zeros <a href="https://en.wikipedia.org/wiki/Find_first_set">can be implemented</a> in terms of this operation.</p>
<h2 id="code">Code</h2>
<p>Below is the complete code. You can also download it <a href="./posts/raw/FFS.hs">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE BangPatterns #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Data.Word</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Data.Bits</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">-- Returns 0-based bit index of most significant bit that is 1. Assumes input is non-zero.</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">-- That is, 2^indexOfMostSignificant1 x &lt;= x &lt; 2^(indexOfMostSignificant1 x + 1)</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">-- From Erik Demaine's presentation in Spring 2012 lectures of MIT 6.851, particularly &quot;Lecture 12: Fusion Trees&quot;.</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">-- Takes 26 (source-level) straight-line word operations.</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="ot">indexOfMostSignificant1 ::</span> <span class="dt">Word64</span> <span class="ot">-&gt;</span> <span class="dt">Word64</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">indexOfMostSignificant1 w <span class="fu">=</span> idxMsbyte <span class="fu">.|.</span> idxMsbit</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        <span class="co">-- top bits of each byte</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="fu">!</span>wtbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x8080808080808080</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        <span class="co">-- all but top bits of each byte producing 8 7-bit chunks</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">        <span class="fu">!</span>wbbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x7F7F7F7F7F7F7F7F</span>              </a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">        <span class="co">-- parallel compare of each 7-bit chunk to 0, top bit set in result if 7-bit chunk was not 0</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">        <span class="fu">!</span>pc <span class="fu">=</span> parallelCompare <span class="bn">0x8080808080808080</span> wbbs</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        <span class="co">-- top bit of each byte set if the byte has any bits set in w</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        <span class="fu">!</span>ne <span class="fu">=</span> wtbs <span class="fu">.|.</span> pc                             </a>
<a class="sourceLine" id="cb1-23" data-line-number="23"></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">        <span class="co">-- a summary of which bytes (except the first) are non-zero as a 7-bit bitfield, i.e. top bits collected into bottom byte</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">        <span class="fu">!</span>summary <span class="fu">=</span> sketch ne <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">        <span class="co">-- parallel compare summary to powers of two</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">        <span class="fu">!</span>cmpp2 <span class="fu">=</span> parallelCompare <span class="bn">0xFFBF9F8F87838180</span> (<span class="bn">0x0101010101010101</span> <span class="fu">*</span> summary)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">        </a>
<a class="sourceLine" id="cb1-30" data-line-number="30">        <span class="co">-- index of most significant non-zero byte * 8</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">        <span class="fu">!</span>idxMsbyte <span class="fu">=</span> sumTopBits8 cmpp2                </a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">        <span class="co">-- most significant 7-bits of most significant non-zero byte</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">        <span class="fu">!</span>msbyte <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> (fromIntegral idxMsbyte)) <span class="fu">.&amp;.</span> <span class="bn">0xFF</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">        <span class="co">-- parallel compare msbyte to powers of two</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">        <span class="fu">!</span>cmpp2' <span class="fu">=</span> parallelCompare <span class="bn">0xFFBF9F8F87838180</span> (<span class="bn">0x0101010101010101</span> <span class="fu">*</span> msbyte)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">        <span class="co">-- index of most significant non-zero bit in msbyte</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40">        <span class="fu">!</span>idxMsbit <span class="fu">=</span> sumTopBits cmpp2' </a>
<a class="sourceLine" id="cb1-41" data-line-number="41"></a>
<a class="sourceLine" id="cb1-42" data-line-number="42">        <span class="co">-- Maps top bits of each byte into lower byte assuming all other bits are 0.</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43">        <span class="co">-- 0x2040810204081 = sum [2^j | j &lt;- map (\i -&gt; 49 - 7*i) [0..7]]</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">        <span class="co">-- In general if w = 2^(2*k+p) and p = 0 or 1 the formula is:</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45">        <span class="co">-- sum [2^j | j &lt;- map (\i -&gt; w-(2^k-1) - 2^(k+p) - (2^(k+p) - 1)*i) [0..2^k-1]]</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">        <span class="co">-- Followed by shifting right by w - 2^k</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47">        sketch w <span class="fu">=</span> (w <span class="fu">*</span> <span class="bn">0x2040810204081</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">56</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49">        parallelCompare w1 w2 <span class="fu">=</span> complement (w1 <span class="fu">-</span> w2) <span class="fu">.&amp;.</span> <span class="bn">0x8080808080808080</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50">        sumTopBits w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">7</span>) <span class="fu">*</span> <span class="bn">0x0101010101010101</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">56</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51">        sumTopBits8 w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">7</span>) <span class="fu">*</span> <span class="bn">0x0808080808080808</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">56</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="ot">indexOfMostSignificant1_w32 ::</span> <span class="dt">Word32</span> <span class="ot">-&gt;</span> <span class="dt">Word32</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54">indexOfMostSignificant1_w32 w <span class="fu">=</span> idxMsbyte <span class="fu">.|.</span> idxMsbit</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">    <span class="kw">where</span> <span class="fu">!</span>wtbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x80808080</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56">          <span class="fu">!</span>wbbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x7F7F7F7F</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57">          <span class="fu">!</span>pc <span class="fu">=</span> parallelCompare <span class="bn">0x80808080</span> wbbs</a>
<a class="sourceLine" id="cb1-58" data-line-number="58">          <span class="fu">!</span>ne <span class="fu">=</span> wtbs <span class="fu">.|.</span> pc</a>
<a class="sourceLine" id="cb1-59" data-line-number="59">          <span class="fu">!</span>summary <span class="fu">=</span> sketch ne <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60">          <span class="fu">!</span>cmpp2 <span class="fu">=</span> parallelCompare <span class="bn">0xFF838180</span> (<span class="bn">0x01010101</span> <span class="fu">*</span> summary)</a>
<a class="sourceLine" id="cb1-61" data-line-number="61">          <span class="fu">!</span>idxMsbyte <span class="fu">=</span> sumTopBits8 cmpp2</a>
<a class="sourceLine" id="cb1-62" data-line-number="62">          <span class="fu">!</span>msbyte <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> (fromIntegral idxMsbyte)) <span class="fu">.&amp;.</span> <span class="bn">0xFF</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63">          <span class="fu">!</span>cmpp2' <span class="fu">=</span> parallelCompare <span class="bn">0x87838180</span> (<span class="bn">0x01010101</span> <span class="fu">*</span> msbyte)</a>
<a class="sourceLine" id="cb1-64" data-line-number="64"></a>
<a class="sourceLine" id="cb1-65" data-line-number="65">          <span class="co">-- extra step when w is not an even power of two</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66">          <span class="fu">!</span>cmpp2'' <span class="fu">=</span> parallelCompare <span class="bn">0xFFBF9F8F</span> (<span class="bn">0x01010101</span> <span class="fu">*</span> msbyte)</a>
<a class="sourceLine" id="cb1-67" data-line-number="67">          <span class="fu">!</span>idxMsbit <span class="fu">=</span> sumTopBits cmpp2' <span class="fu">+</span> sumTopBits cmpp2''</a>
<a class="sourceLine" id="cb1-68" data-line-number="68"></a>
<a class="sourceLine" id="cb1-69" data-line-number="69">          sketch w <span class="fu">=</span> (w <span class="fu">*</span> <span class="bn">0x204081</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">28</span></a>
<a class="sourceLine" id="cb1-70" data-line-number="70">          parallelCompare w1 w2 <span class="fu">=</span> complement (w1 <span class="fu">-</span> w2) <span class="fu">.&amp;.</span> <span class="bn">0x80808080</span></a>
<a class="sourceLine" id="cb1-71" data-line-number="71">          sumTopBits w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">7</span>) <span class="fu">*</span> <span class="bn">0x01010101</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">24</span></a>
<a class="sourceLine" id="cb1-72" data-line-number="72">          sumTopBits8 w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">7</span>) <span class="fu">*</span> <span class="bn">0x08080808</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">24</span></a>
<a class="sourceLine" id="cb1-73" data-line-number="73"></a>
<a class="sourceLine" id="cb1-74" data-line-number="74"><span class="ot">indexOfMostSignificant1_w16 ::</span> <span class="dt">Word16</span> <span class="ot">-&gt;</span> <span class="dt">Word16</span></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">indexOfMostSignificant1_w16 w <span class="fu">=</span> idxMsnibble <span class="fu">.|.</span> idxMsbit</a>
<a class="sourceLine" id="cb1-76" data-line-number="76">    <span class="kw">where</span> <span class="fu">!</span>wtbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x8888</span></a>
<a class="sourceLine" id="cb1-77" data-line-number="77">          <span class="fu">!</span>wbbs <span class="fu">=</span> w <span class="fu">.&amp;.</span> <span class="bn">0x7777</span></a>
<a class="sourceLine" id="cb1-78" data-line-number="78">          <span class="fu">!</span>pc <span class="fu">=</span> parallelCompare <span class="bn">0x8888</span> wbbs</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">          <span class="fu">!</span>ne <span class="fu">=</span> wtbs <span class="fu">.|.</span> pc</a>
<a class="sourceLine" id="cb1-80" data-line-number="80">          <span class="fu">!</span>summary <span class="fu">=</span> sketch ne <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-81" data-line-number="81">          <span class="fu">!</span>cmpp2 <span class="fu">=</span> parallelCompare <span class="bn">0xFB98</span> (<span class="bn">0x1111</span> <span class="fu">*</span> summary)</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">          <span class="fu">!</span>idxMsnibble <span class="fu">=</span> sumTopBits4 cmpp2</a>
<a class="sourceLine" id="cb1-83" data-line-number="83">          <span class="fu">!</span>msnibble <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> (fromIntegral idxMsnibble)) <span class="fu">.&amp;.</span> <span class="bn">0xF</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-84" data-line-number="84">          <span class="fu">!</span>cmpp2' <span class="fu">=</span> parallelCompare <span class="bn">0xFB98</span> (<span class="bn">0x1111</span> <span class="fu">*</span> msnibble)</a>
<a class="sourceLine" id="cb1-85" data-line-number="85">          <span class="fu">!</span>idxMsbit <span class="fu">=</span> sumTopBits cmpp2'</a>
<a class="sourceLine" id="cb1-86" data-line-number="86"></a>
<a class="sourceLine" id="cb1-87" data-line-number="87">          sketch w <span class="fu">=</span> (w <span class="fu">*</span> <span class="bn">0x249</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">12</span></a>
<a class="sourceLine" id="cb1-88" data-line-number="88">          parallelCompare w1 w2 <span class="fu">=</span> complement (w1 <span class="fu">-</span> w2) <span class="fu">.&amp;.</span> <span class="bn">0x8888</span></a>
<a class="sourceLine" id="cb1-89" data-line-number="89">          sumTopBits w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">3</span>) <span class="fu">*</span> <span class="bn">0x1111</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">12</span></a>
<a class="sourceLine" id="cb1-90" data-line-number="90">          sumTopBits4 w <span class="fu">=</span> ((w <span class="ot">`unsafeShiftR`</span> <span class="dv">3</span>) <span class="fu">*</span> <span class="bn">0x4444</span>) <span class="ot">`unsafeShiftR`</span> <span class="dv">12</span></a></code></pre></div>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            November 10, 2016 07:48 UTC
            
            (Last updated on November 13, 2016 00:50 UTC)

            
                Tags: <a href="./tags/programming.html">programming</a>, <a href="./tags/CS.html">CS</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/quotient-types-for-programmers.html">Quotient Types for Programmers</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="8e5f33ef-46e2-4815-a9b1-5c4c46edc4ee" href="./posts/quotient-types-for-programmers.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h2 id="introduction">Introduction</h2>
<p>Programmers in typed languages with higher order functions and algebraic data types are already comfortable with most of the basic constructions of set/type theory. In categorical terms, those programmers are familiar with finite products and coproducts and (monoidal/cartesian) closed structure. The main omissions are subset types (equalizers/pullbacks) and quotient types (coequalizers/pushouts) which would round out limits and colimits. Not having a good grasp on either of these constructions dramatically shrinks the world of mathematics that is understandable, but while subset types are fairly straightforward, quotient types are quite a bit less intuitive.</p>
<h2 id="subset-types">Subset Types</h2>
<p>In my opinion, most programmers can more or less immediately understand the notion of a subset type at an intuitive level.<br />
A <strong>subset type</strong> is just a type combined with a predicate on that type that specifies which values of the type we want. For example, we may have something like <code>{ n:Nat | n /= 0 }</code> meaning the type of naturals not equal to #0#. We may use this in the type of the division function for the denominator. Consuming a value of a subset type is easy, a natural not equal to #0# is still just a natural, and we can treat it as such. The difficult part is producing a value of a subset type. To do this, we must, of course, produce a value of the underlying type — <code>Nat</code> in our example — but then we must further convince the type checker that the predicate holds (e.g. that the value does not equal #0#). Most languages provide no mechanism to prove potentially arbitrary facts about code, and this is why they do not support subset types. Dependently typed languages do provide such mechanisms and thus either have or can encode subset types. Outside of dependently typed languages the typical solution is to use an abstract data type and use a runtime check when values of that abstract data type are created.</p>
<h2 id="quotient-types">Quotient Types</h2>
<p>The dual of subset types are quotient types. My impression is that this construction is the most difficult basic construction for people to understand. Further, programmers aren’t much better off, because they have little to which to connect the idea. Before I give a definition, I want to provide the example with which most people are familiar: modular (or clock) arithmetic. A typical way this is first presented is as a system where the numbers “wrap-around”. For example, in arithmetic mod #3#, we count #0#, #1#, #2#, and then wrap back around to #0#. Programmers are well aware that it’s not necessary to guarantee that an input to addition, subtraction, or multiplication mod #3# is either #0#, #1#, or #2#. Instead, the operation can be done and the <code>mod</code> function can be applied at the end. This will give the same result as applying the <code>mod</code> function to each argument at the beginning. For example, #4+7 = 11# and #11 mod 3 = 2#, and #4 mod 3 = 1# and #7 mod 3 = 1# and #1+1 = 2 = 11 mod 3#.</p>
<p>For mathematicians, the type of integers mod #n# is represented by the quotient type #ZZ//n ZZ#. The idea is that the values of #ZZ // n ZZ# are integers except that we agree that any two integers #a# and #b# are treated as equal if #a - b = kn# for some integer #k#. For #ZZ // 3 ZZ#, #… -6 = -3 = 0 = 3 = 6 = …# and #… = -5 = -2 = 1 = 4 = 7 = …# and #… = -4 = -1 = 2 = 5 = 8 = …#.</p>
<h2 id="equivalence-relations">Equivalence Relations</h2>
<p>To start to formalize this, we need the notion of an equivalence relation. An <strong>equivalence relation</strong> is a binary relation <code class="asciimath">#(~~)#</code> which is <strong>reflexive</strong> (#x ~~ x# for all #x#), <strong>symmetric</strong> (if <code class="asciimath">#x ~~ y#</code> then <code class="asciimath">#y ~~ x#</code>), and <strong>transitive</strong> (if <code class="asciimath">#x ~~ y#</code> and <code class="asciimath">#y ~~ z#</code> then <code class="asciimath">#x ~~ z#</code>). We can check that “#a ~~ b# iff there exists an integer #k# such that #a-b = kn#” defines an equivalence relation on the integers for any given #n#. For reflexivity we have #a - a = 0n#. For symmetry we have if #a - b = kn# then #b - a = -kn#. Finally, for transitivity we have if #a - b = k_1 n# and #b - c = k_2 n# then #a - c = (k_1 + k_2)n# which we get by adding the preceding two equations.</p>
<p>Any relation can be extended to an equivalence relation. This is called the reflexive-, symmetric-, transitive-closure of the relation. For an arbitrary binary relation #R# we can define the equivalence relation #(~~_R)# via &quot;#a ~~_R b# iff #a = b# or #R(a, b)# or #b ~~_R a# or #a ~~_R c and c ~~_R b# for some #c#&quot;. To be precise, #~~_R# is the smallest relation satisfying those constraints. In Datalog syntax, this looks like:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode prolog"><code class="sourceCode prolog"><a class="sourceLine" id="cb1-1" data-line-number="1">eq_r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">A</span>)<span class="kw">.</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">eq_r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">B</span>) <span class="kw">:-</span> r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">B</span>)<span class="kw">.</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">eq_r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">B</span>) <span class="kw">:-</span> eq_r(<span class="dt">B</span><span class="kw">,</span> <span class="dt">A</span>)<span class="kw">.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">eq_r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">B</span>) <span class="kw">:-</span> eq_r(<span class="dt">A</span><span class="kw">,</span> <span class="dt">C</span>)<span class="kw">,</span> eq_r(<span class="dt">C</span><span class="kw">,</span> <span class="dt">B</span>)<span class="kw">.</span></a></code></pre></div>
<h2 id="quotient-types-the-type-theory-view">Quotient Types: the Type Theory view</h2>
<p>If #T# is a type, and <code class="asciimath">#(~~)#</code> is an equivalence relation, we use #T // ~~# as the notation for the <strong>quotient type</strong>, which we read as “#T# quotiented by the equivalence relation <code class="asciimath">#(~~)#</code>”. We call #T# the <strong>underlying type</strong> of the quotient type. We then say #a = b# at type #T // ~~# iff #a ~~ b#. Dual to subset types, to produce a value of a quotient type is easy. Any value of the underlying type is a value of the quotient type. (In type theory, this produces the perhaps surprising result that #ZZ# is a <em>subtype</em> of #ZZ // n ZZ#.) As expected, consuming a value of a quotient type is more complicated. To explain this, we need to explain what a function #f : T // ~~ -&gt; X# is for some type #X#. A function #f : T // ~~ -&gt; X# is a function #g : T -&gt; X# which satisfies #g(a) = g(b)# for all #a# and #b# such that #a ~~ b#. We call #f# (or #g#, they are often conflated) <strong>well-defined</strong> if #g# satisfies this condition. In other words, any well-defined function that consumes a quotient type isn’t allowed to produce an output that distinguishes between equivalent inputs. A better way to understand this is that quotient types allow us to change what the notion of equality is for a type. From this perspective, a function being well-defined just means that it is a function. Taking equal inputs to equal outputs is one of the defining characteristics of a function.</p>
<p>Sometimes we can finesse needing to check the side condition. Any function #h : T -&gt; B# gives rise to an equivalence relation on #T# via #a ~~ b# iff #h(a) = h(b)#. In this case, any function #g : B -&gt; X# gives rise to a function #f : T // ~~ -&gt; X# via #f = g @ h#. In particular, when #B = T# we are guaranteed to have a suitable #g# for any function #f : T // ~~ -&gt; X#. In this case, we can implement quotient types in a manner quite similar subset types, namely we make an abstract type and we normalize with the #h# function as we either produce or consume values of the abstract type. A common example of this is rational numbers. We can reduce a rational number to lowest terms either when it’s produced or when the numerator or denominator get accessed, so that we don’t accidentally write functions which distinguish between #1/2# and #2/4#. For modular arithmetic, the mod by #n# function is a suitable #h#.</p>
<h2 id="quotient-types-the-set-theory-view">Quotient Types: the Set Theory view</h2>
<p>In set theory such an #h# function can always be made by mapping the elements of #T# to the equivalence classes that contain them, i.e. #a# gets mapped to #{b | a ~~ b}# which is called the <strong>equivalence class</strong> of #a#. In fact, in set theory, #T // ~~# is usually defined to <em>be</em> the set of equivalence classes of <code class="asciimath">#(~~)#</code>. So, for the example of #ZZ // 3 ZZ#, in set theory, it is a set of exactly three elements: the elements are #{ 3n+k | n in ZZ}# for #k = 0, 1, 2#. Equivalence classes are also called <strong>partitions</strong> and are said to partition the underlying set. Elements of these equivalence classes are called <strong>representatives</strong> of the equivalence class. Often a notation like #[a]# is used for the equivalence class of #a#.</p>
<h2 id="more-examples">More Examples</h2>
<p>Here is a quick run-through of some significant applications of quotient types. I’ll give the underlying type and the equivalence relation and what the quotient type produces. I’ll leave it as an exercise to verify that the equivalence relations really are equivalence relations, i.e. reflexive, symmetric, and transitive. I’ll start with more basic examples. You should work through them to be sure you understand how they work.</p>
<h3 id="integers">Integers</h3>
<p>Integers can be presented as pairs of naturals #(n, m)# with the idea being that the pair represents “#n - m#”. Of course, #1 - 2# should be the same as #2 - 3#. This is expressed as #(n_1, m_1) ~~ (n_2, m_2)# iff #n_1 + m_2 = n_2 + m_1#. Note how this definition only relies on operations on natural numbers. You can explore how to define addition, subtraction, multiplication, and other operations on this representation in a well-defined manner.</p>
<h3 id="rationals">Rationals</h3>
<p>Rationals can be presented very similarly to integers, only with multiplication instead of addition. We also have pairs #(n, d)#, usually written #n/d#, in this case of an integer #n# and a non-zero natural #d#. The equivalence relation is #(n_1, d_1) ~~ (n_2, d_2)# iff #n_1 d_2 = n_2 d_1#.</p>
<h3 id="topological-circles">(Topological) Circles</h3>
<p>We can extend the integers mod #n# to the continuous case. Consider the real numbers with the equivalence relation #r ~~ s# iff #r - s = k# for some integer #k#. You could call this the reals mod #1#. Topologically, this is a circle. If you walk along it far enough, you end up back at a point equivalent to where you started. Occasionally this is written as #RR//ZZ#.</p>
<h3 id="torii">Torii</h3>
<p>Doing the previous example in 2D gives a torus. Specifically, we have pairs of real numbers and the equivalence relation #(x_1, y_1) ~~ (x_2, y_2)# iff #x_1 - x_2 = k# and #y_1 - y_2 = l# for some integers #k# and #l#. Quite a bit of topology relies on similar constructions as will be expanded upon on the section on gluing.</p>
<h3 id="unordered-pairs">Unordered pairs</h3>
<p>Here’s an example that’s a bit closer to programming. Consider the following equivalence relation on arbitrary pairs: #(a_1, b_1) ~~ (a_2, b_2)# iff #a_1 = a_2 and b_1 = b_2# or #a_1 = b_2 and b_1 = a_2#. This just says that a pair is equivalent to either itself, or a swapped version of itself. It’s interesting to consider what a well-defined function is on this type.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<h3 id="gluing-pushouts">Gluing / Pushouts</h3>
<p>Returning to topology and doing a bit more involved construction, we arrive at gluing or pushouts. In topology, we often want to take two topological spaces and glue them together in some specified way. For example, we may want to take two discs and glue their boundaries together. This gives a sphere. We can combine two spaces into one with the disjoint sum (or coproduct, i.e. Haskell’s <code>Either</code> type.) This produces a space that contains both the input spaces, but they don’t interact in any way. You can visualize them as sitting next to each other but not touching. We now want to say that certain pairs of points, one from each of the spaces, are really the same point. That is, we want to quotient by an equivalence relation that would identify those points. We need some mechanism to specify which points we want to identify. One way to accomplish this is to have a pair of functions, #f : C -&gt; A# and #g : C -&gt; B#, where #A# and #B# are the spaces we want to glue together. We can then define a relation #R# on the disjoint sum via #R(a, b)# iff there’s a #c : C# such that <code class="asciimath">#a = tt &quot;inl&quot;(f(c)) and b = tt &quot;inr&quot;(g(c))#</code>. This is not an equivalence relation, but we can extend it to one. The quotient we get is then the gluing of #A# and #B# specified by #C# (or really by #f# and #g#). For our example of two discs, #f# and #g# are the same function, namely the inclusion of the boundary of the disc into the disc. We can also glue a space to itself. Just drop the disjoint sum part. Indeed, the circle and torus are examples.</p>
<h3 id="polynomial-ring-ideals">Polynomial ring ideals</h3>
<p>We write #RR[X]# for the type of polynomials with one indeterminate #X# with real coefficients. For two indeterminates, we write #RR[X, Y]#. Values of these types are just polynomials such as #X^2 + 1# or #X^2 + Y^2#. We can consider quotienting these types by equivalence relations generated from identifications like #X^2 + 1 ~~ 0# or #X^2 - Y ~~ 0#, but we want more than just the reflexive-, symmetric-, transitive-closure. We want this equivalence relation to also respect the operations we have on polynomials, in particular, addition and multiplication. More precisely, we want if #a ~~ b# and #c ~~ d# then #ac ~~ bd# and similarly for addition. An equivalence relation that respects all operations is called a <strong>congruence</strong>. The standard notation for the quotient of #RR[X, Y]# by a congruence generated by both of the previous identifications is #RR[X, Y]//(X^2 + 1, X^2 - Y)#. Now if #X^2 + 1 = 0# in #RR[X, Y]//(X^2 + 1, X^2 - Y)#, then for <em>any</em> polynomial #P(X, Y)#, we have #P(X, Y)(X^2 + 1) = 0# because #0# times anything is #0#. Similarly, for any polynomial #Q(X, Y)#, #Q(X, Y)(X^2 - Y) = 0#. Of course, #0 + 0 = 0#, so it must be the case that #P(X, Y)(X^2 + 1) + Q(X, Y)(X^2 - Y) = 0# for all polynomials #P# and #Q#. In fact, we can show that all elements in the equivalence class of #0# are of this form. You’ve now motivated the concrete definition of a ring ideal and given it’s significance. An <strong>ideal</strong> is an equivalence class of #0# with respect to some congruence. Let’s work out what #RR[X, Y]//(X^2 + 1, X^2 - Y)# looks like concretely. First, since #X^2 - Y = 0#, we have #Y = X^2# and so we see that values of #RR[X, Y]//(X^2 + 1, X^2 - Y)# will be polynomials in only one indeterminate because we can replace all #Y#s with #X^2#s. Since #X^2 = -1#, we can see that all those polynomials will be linear (i.e. of degree 1) because we can just keep replacing #X^2#s with #-1#s, i.e. #X^(n+2) = X^n X^2 = -X^n#. The end result is that an arbitrary polynomial in #RR[X, Y]//(X^2 + 1, X^2 - Y)# looks like #a + bX# for real numbers #a# and #b# and we have #X^2 = -1#. In other words, #RR[X, Y]//(X^2 + 1, X^2 - Y)# is isomorphic to the complex numbers, #CC#.</p>
<p>As a reasonably simple exercise, given a polynomial #P(X) : RR[X]#, what does it get mapped to when embedded into #RR[X]//(X - 3)#, i.e. what is #[P(X)] : RR[X]//(X - 3)#?<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<h3 id="free-algebras-modulo-an-equational-theory">Free algebras modulo an equational theory</h3>
<p>Moving much closer to programming, we have a rather broad and important example that a mathematician might describe as free algebras modulo an equational theory. This example covers several of the preceding examples. In programmer-speak, a free algebra is just a type of abstract syntax trees for some language. We’ll call a specific abstract syntax tree a <strong>term</strong>. An equational theory is just a collection of pairs of terms with the idea being that we’d like these terms to be considered equal. To be a bit more precise, we will actually allow terms to contain (meta)variables. An example equation for an expression language might be <code>Add(</code>#x#<code>,</code>#x#<code>) = Mul(2,</code>#x#<code>)</code>. We call a term with no variables a <strong>ground term</strong>. We say a ground term <strong>matches</strong> another term if there is a consistent substitution for the variables that makes the latter term syntactically equal to the ground term. E.g. <code>Add(3, 3)</code> matches <code>Add(</code>#x#<code>,</code>#x#<code>)</code> via the substitution #x |-&gt;#<code>3</code>. Now, the equations of our equational theory gives rise to a relation on ground terms #R(t_1, t_2)# iff there exists an equation #l = r# such that #t_1# matches #l# and #t_2# matches #r#. This relation can be extended to an equivalence relation on ground terms, and we can then quotient by that equivalence relation.</p>
<p>Let’s consider a worked example. We can consider the theory of monoids. We have two operations (types of AST nodes): <code>Mul(</code>#x#<code>,</code>#y#<code>)</code> and <code>1</code>. We have the following three equations: <code>Mul(1,</code>#x#<code>) =</code>#x#, <code>Mul(</code>#x#<code>, 1) =</code>#x#, and <code>Mul(Mul(</code>#x#<code>,</code>#y#<code>),</code>#z#<code>) = Mul(</code>#x#<code>, Mul(</code>#y#<code>,</code>#z#<code>))</code>. We additionally have a bunch of constants subject to no equations. In this case, it turns out we can define a normalization function, what I called #h# far above, and that the quotient type is isomorphic to lists of constants. Now, we can extend this theory to the theory of groups by adding a new operation, <code>Inv(</code>#x#<code>)</code>, and new equations: <code>Inv(Inv(</code>#x#<code>)) =</code>#x#, <code>Inv(Mul(</code>#x#<code>,</code>#y#<code>)) = Mul(Inv(</code>#y#<code>), Inv(</code>#x#<code>))</code>, and <code>Mul(Inv(</code>#x#<code>),</code>#x#<code>) = 1</code>. If we ignore the last of these equations, you can show that we can normalize to a form that is isomorphic to a list of a disjoint sum of the constants, i.e. <code>[Either Const Const]</code> in Haskell if <code>Const</code> were the type of the constant terms. Quotienting this type by the equivalence relation extended with that final equality corresponds to adding the rule that a <code>Left c</code> cancels out <code>Right c</code> in the list whenever they are adjacent.</p>
<p>This overall example is a fairly profound one. Almost all of abstract algebra can be viewed as an instance of this or a closely related variation. When you hear about things defined in terms of “generators and relators”, it is an example of this sort. Indeed, those “relators” are used to define a relation that will be extended to an equivalence relation. Being defined in this way is arguably what it <em>means</em> for something to be “algebraic”.</p>
<h2 id="postscript">Postscript</h2>
<p>The <a href="http://www.nuprl.org/book/Introduction_Type_Theory.html">Introduction to Type Theory</a> section of the NuPRL book provides a more comprehensive and somewhat more formal presentation of these and related concepts. While the quotient <em>type</em> view of quotients is conceptually different from the standard set theoretic presentation, it is much more amenable to computation as the #ZZ // n ZZ# example begins to illustrate.</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>It’s a commutative function.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>It gets mapped to it’s value at #3#, i.e. #P(3)#.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</section>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            September 23, 2016 05:21 UTC
            
            (Last updated on February 26, 2017 21:27 UTC)

            
                Tags: <a href="./tags/math.html">math</a>, <a href="./tags/type%20theory.html">type theory</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/constructivist-motto.html">Constructivist Motto</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="c284bd21-75e4-4c66-a499-49f3719f7a09" href="./posts/constructivist-motto.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <blockquote>
<p>I don’t believe classical logic is false; I just believe that it is not true.</p>
</blockquote>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            May  7, 2016 18:12 UTC
            
            (Last updated on May  7, 2016 18:17 UTC)

            
                Tags: <a href="./tags/math.html">math</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/the-mistake-everyone-makes-with-knockoutjs.html">The Mistake Everyone Makes with KnockoutJS</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="d07dccbe-b66a-437f-b8fc-0c4442d340b6" href="./posts/the-mistake-everyone-makes-with-knockoutjs.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h3 id="introduction">Introduction</h3>
<p><a href="http://knockoutjs.com">Knockout</a> is a nice JavaScript library for making values that automatically update when any of their “dependencies” update. Those dependencies can form an arbitrary directed acyclic graph. Many people seem to think of it as “yet another” templating library, but the core idea which is useful far beyond “templating” is the notion of observable values. One nice aspect is that it is a library and not a framework so you can use it as little or as much as you want and you can integrate it with other libraries and frameworks.</p>
<p>At any rate, this article is more geared toward those who have already decided on using Knockout or a library (in any language) offering similar capabilities. I strongly suspect the issues and solutions I’ll discuss apply to all similar sorts of libraries. While I’ll focus on one particular example, the ideas behind it apply generally. This example, admittedly, is one that almost anyone will implement, and in my experience will do it incorrectly the first time and won’t realize the problem until later.</p>
<h3 id="the-problem">The Problem</h3>
<p>When doing any front-end work, before long there will be a requirement to support “multi-select” of something. Of course, you want the standard select/deselect all functionality and for it to work correctly, and of course you want to do something with the items you’ve selected. Here’s a very simple example:</p>
<div id="#badExample">
Number selected: <span data-bind="text: $data.numberSelected()"></span>
<table>
<tr>
<th>
<input type="checkbox" data-bind="checked: $data.allSelected" />
</th>
<th>
Item
</th>
</tr>
<!-- ko foreach: { data: $data.items(), as: '$item' } -->
<tr>
<td>
<input type="checkbox" data-bind="checked: $data.selected" />
</td>
<td data-bind="text: 'Item number: '+$data.body">
</td>
</tr>
<!-- /ko -->
<tr>
<td>
<button data-bind="click: function() { $data.add(); }">
Add
</button>
</td>
</tr>
</table>
</div>
<p>Here, the number selected is an overly simple example of using the selected items. More realistically, the selected items will trigger other items to show up and/or trigger AJAX requests to update the data or populate other data. The HTML for this example is completely straightforward.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;#badExample&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    Number selected: <span class="kw">&lt;span</span><span class="ot"> data-bind=</span><span class="st">&quot;text: $data.numberSelected()&quot;</span><span class="kw">&gt;&lt;/span&gt;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="kw">&lt;table&gt;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">        <span class="kw">&lt;tr&gt;&lt;th&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> data-bind=</span><span class="st">&quot;checked: $data.allSelected&quot;</span><span class="kw">/&gt;&lt;/th&gt;&lt;th&gt;</span>Item<span class="kw">&lt;/th&gt;&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">        <span class="co">&lt;!-- ko foreach: { data: $data.items(), as: '$item' } --&gt;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">        <span class="kw">&lt;tr&gt;&lt;td&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> data-bind=</span><span class="st">&quot;checked: $data.selected&quot;</span><span class="kw">/&gt;&lt;/td&gt;&lt;td</span><span class="ot"> data-bind=</span><span class="st">&quot;text: 'Item number: '+$data.body&quot;</span><span class="kw">&gt;&lt;/td&gt;&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        <span class="co">&lt;!-- /ko --&gt;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="kw">&lt;tr&gt;&lt;td&gt;&lt;button</span><span class="ot"> data-bind=</span><span class="st">&quot;click: function() { $data.add(); }&quot;</span><span class="kw">&gt;</span>Add<span class="kw">&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="kw">&lt;/table&gt;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">&lt;/div&gt;</span></a></code></pre></div>
<p>The way nearly everyone (including me) first thinks to implement this is by adding a <code>selected</code> observable to each item and then having <code>allSelected</code> depend on all of the <code>selected</code> observables. Since we also want to write to <code>allSelected</code> to change the state of the <code>selected</code> observables we use a <a href="http://knockoutjs.com/documentation/computed-writable.html">writable computed observable</a>. This computed observable will loop through all the items and check to see if they are all set to determine it’s state. When it is updated, it will loop through all the <code>selected</code> observables and set them to the appropriate state. Here’s the full code listing.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">var</span> badViewModel <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    <span class="dt">counter</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">items</span><span class="op">:</span> <span class="va">ko</span>.<span class="at">observableArray</span>()</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="va">badViewModel</span>.<span class="at">allSelected</span> <span class="op">=</span> <span class="va">ko</span>.<span class="at">computed</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="dt">read</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">        <span class="kw">var</span> items <span class="op">=</span> <span class="va">badViewModel</span>.<span class="at">items</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">        <span class="kw">var</span> allSelected <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">        <span class="cf">for</span>(<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">items</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span> <span class="co">// Need to make sure we depend on each item, so don't break out of loop early</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">            allSelected <span class="op">=</span> allSelected <span class="op">&amp;&amp;</span> items[i].<span class="at">selected</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        <span class="cf">return</span> allSelected<span class="op">;</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">    <span class="dt">write</span><span class="op">:</span> <span class="kw">function</span>(newValue) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">        <span class="kw">var</span> items <span class="op">=</span> <span class="va">badViewModel</span>.<span class="at">items</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">        <span class="cf">for</span>(<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">items</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">            items[i].<span class="at">selected</span>(newValue)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="va">badViewModel</span>.<span class="at">numberSelected</span> <span class="op">=</span> <span class="va">ko</span>.<span class="at">computed</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">    <span class="kw">var</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">    <span class="kw">var</span> items <span class="op">=</span> <span class="va">badViewModel</span>.<span class="at">items</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="cf">for</span>(<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">items</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">        <span class="cf">if</span>(items[i].<span class="at">selected</span>()) count<span class="op">++;</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">    <span class="cf">return</span> count<span class="op">;</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="va">badViewModel</span>.<span class="at">add</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">    <span class="va">badViewModel</span>.<span class="va">items</span>.<span class="at">push</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34">        <span class="dt">body</span><span class="op">:</span> <span class="va">badViewModel</span>.<span class="at">counter</span><span class="op">++,</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">        <span class="dt">selected</span><span class="op">:</span> <span class="va">ko</span>.<span class="at">observable</span>(<span class="kw">false</span>)</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="va">ko</span>.<span class="at">applyBindings</span>(badViewModel<span class="op">,</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'#badExample'</span>))<span class="op">;</span></a></code></pre></div>
<p>This should be relatively straightforward, and it works, so what’s the problem? The problem can be seen in <code>numberSelected</code> (and it also comes up with <code>allSelected</code> which I’ll get to momentarily). <code>numberSelected</code> depends on <em>each</em> <code>selected</code> observable and so it will be fired <em>each</em> time <em>each</em> one updates. That means if you have 100 items, and you use the select all checkbox, <code>numberSelected</code> will be called 100 times. For this example, that doesn’t really matter. For a more realistic example than <code>numberSelected</code>, this may mean rendering one, then two, then three, … then 100 HTML fragments or making 100 AJAX requests. In fact, this same behavior is present in <code>allSelected</code>. When it is written, as it’s writing to the <code>selected</code> observables, it is also triggering <em>itself</em>.</p>
<p>So the problem is updating <code>allSelected</code> or <code>numberSelected</code> can’t be done all at once, or to use database terminology, it can’t be updated atomically. One possible solution in newer versions of Knockout is to use <code>deferredUpdates</code> or, what I did back in the much earlier versions of Knockout, abuse the rate limiting features. The problem with this solution is that it makes updates asynchronous. If you’ve written your code to not care whether it was called synchronously or asynchronously, then this will work fine. If you haven’t, doing this throws you into a world of shared state concurrency and race conditions. In this case, this solution is far worse than the disease.</p>
<h3 id="the-solution">The Solution</h3>
<p>So, what’s the alternative? We want to update all selected items atomically; we can atomically update a single observable; so we’ll put all selected items into a single observable. Now an item determines if it is selected by checking whether it is in the collection of selected items. More abstractly, we make our observables more coarse-grained, and we have a bunch of small computed observables depend on a large observable instead of a large computed observable depending on a bunch of small observables as we had in the previous code. Here’s an example using the exact same HTML and presenting the same overt behavior.</p>
<div id="#goodExample">
Number selected: <span data-bind="text: $data.numberSelected()"></span>
<table>
<tr>
<th>
<input type="checkbox" data-bind="checked: $data.allSelected" />
</th>
<th>
Item
</th>
</tr>
<!-- ko foreach: { data: $data.items(), as: '$item' } -->
<tr>
<td>
<input type="checkbox" data-bind="checked: $data.selected" />
</td>
<td data-bind="text: 'Item number: '+$data.body">
</td>
</tr>
<!-- /ko -->
<tr>
<td>
<button data-bind="click: function() { $data.add(); }">
Add
</button>
</td>
</tr>
</table>
</div>
<p>And here’s the code behind this second example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">var</span> goodViewModel <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="dt">counter</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="dt">selectedItems</span><span class="op">:</span> <span class="va">ko</span>.<span class="at">observableArray</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">items</span><span class="op">:</span> <span class="va">ko</span>.<span class="at">observableArray</span>()</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="va">goodViewModel</span>.<span class="at">allSelected</span> <span class="op">=</span> <span class="va">ko</span>.<span class="at">computed</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="dt">read</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">        <span class="cf">return</span> <span class="va">goodViewModel</span>.<span class="at">items</span>().<span class="at">length</span> <span class="op">===</span> <span class="va">goodViewModel</span>.<span class="at">selectedItems</span>().<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="op">},</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="dt">write</span><span class="op">:</span> <span class="kw">function</span>(newValue) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">        <span class="cf">if</span>(newValue) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">            <span class="va">goodViewModel</span>.<span class="at">selectedItems</span>(<span class="va">goodViewModel</span>.<span class="at">items</span>().<span class="at">slice</span>(<span class="dv">0</span>))<span class="op">;</span> <span class="co">// Need a copy!</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">            <span class="va">goodViewModel</span>.<span class="va">selectedItems</span>.<span class="at">removeAll</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="va">goodViewModel</span>.<span class="at">numberSelected</span> <span class="op">=</span> <span class="va">ko</span>.<span class="at">computed</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    <span class="cf">return</span> <span class="va">goodViewModel</span>.<span class="at">selectedItems</span>().<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="va">goodViewModel</span>.<span class="at">add</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">    <span class="kw">var</span> item <span class="op">=</span> <span class="op">{</span> <span class="dt">body</span><span class="op">:</span> <span class="va">goodViewModel</span>.<span class="at">counter</span><span class="op">++</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">    <span class="va">item</span>.<span class="at">selected</span> <span class="op">=</span> <span class="va">ko</span>.<span class="at">computed</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">        <span class="dt">read</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28">            <span class="cf">return</span> <span class="va">goodViewModel</span>.<span class="va">selectedItems</span>.<span class="at">indexOf</span>(item) <span class="op">&gt;</span> <span class="dv">-1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29">        <span class="op">},</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30">        <span class="dt">write</span><span class="op">:</span> <span class="kw">function</span>(newValue) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31">            <span class="cf">if</span>(newValue) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32">                <span class="va">goodViewModel</span>.<span class="va">selectedItems</span>.<span class="at">push</span>(item)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33">            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34">                <span class="va">goodViewModel</span>.<span class="va">selectedItems</span>.<span class="at">remove</span>(item)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35">            <span class="op">}</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-38" data-line-number="38">    <span class="va">goodViewModel</span>.<span class="va">items</span>.<span class="at">push</span>(item)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-39" data-line-number="39"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-40" data-line-number="40"></a>
<a class="sourceLine" id="cb3-41" data-line-number="41"><span class="va">ko</span>.<span class="at">applyBindings</span>(goodViewModel<span class="op">,</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'#goodExample'</span>))<span class="op">;</span></a></code></pre></div>
<p>One thing to note is that setting <code>allSelected</code> and <code>numberSelected</code> are now both simple operations. A write to an observable triggers a constant number of writes to other observables. In fact, there are only two (non-computed) observables. On the other hand, <em>reading</em> the <code>selected</code> observable is more expensive. Toggling all items has quadratic complexity. In fact, it had quadratic complexity before due to the feedback. However, unlike the previous code, this <em>also</em> has quadratic complexity when any <em>individual</em> item is toggled. Unlike the previous code, though, this is simply due to a poor choice of data structure. Equipping each item with an “ID” field and using an object as a hash map would reduce the complexity to linear. In practice, for this sort of scenario, it tends not to make a big difference. Also, Knockout won’t trigger dependents if the value doesn’t change, so there’s no risk of the extra work propagating into still more extra work. Nevertheless, while I endorse this solution for this particular problem, in general making <em>finer</em> grained observables can help limit the scope of changes so unnecessary work isn’t done.</p>
<p>Still, the real concern and benefit of this latter approach isn’t the asymptotic complexity of the operations, but the <em>atomicity</em> of the operations. In the second solution, every update is atomic. There are no intermediate states on the way to a final state. This means that dependents, represented by <code>numberSelected</code> but which are realistically much more complicated, don’t get triggered excessively and don’t need to “compensate” for unintended intermediate values.</p>
<h3 id="epilogue">Epilogue</h3>
<p>We could take the coarse-graining to its logical conclusion and have the view model for an application be a single observable holding an object representing the entire view model (and containing no observables of its own). Taking this approach actually does have a lot of benefits, albeit there is little reason to use Knockout at that point. Instead this starts to lead to things like Facebook’s <a href="https://facebook.github.io/flux/">Flux</a> pattern and the pattern perhaps most clearly articulated by <a href="http://cycle.js.org/">Cycle JS</a>.</p>
<script lang="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.3.0.js" integrity="sha384-bpY4Nxr8KotrByPQIhZdNw6qY1QFNMhtBX0QfW7o0e75Z3HAyJ4yeJByRGMMQ6I+" crossorigin="anonymous"></script>
<script lang="text/javascript">
// Bad View Model

var badViewModel = {
    counter: 0,
    items: ko.observableArray()
};

badViewModel.allSelected = ko.computed({
    read: function() {
        var items = badViewModel.items();
        var allSelected = true;
        for(var i = 0; i < items.length; i++) { // Need to make sure we depend on each item, so don't break out of loop early
            allSelected = allSelected && items[i].selected();
        }
        return allSelected;
    },
    write: function(newValue) {
        var items = badViewModel.items();
        for(var i = 0; i < items.length; i++) {
            items[i].selected(newValue);
        }
    }
});

badViewModel.numberSelected = ko.computed(function() {
    var count = 0;
    var items = badViewModel.items();
    for(var i = 0; i < items.length; i++) {
        if(items[i].selected()) count++;
    }
    return count;
});

badViewModel.add = function() {
    badViewModel.items.push({
        body: badViewModel.counter++,
        selected: ko.observable(false)
    });
};


// Good View Model

var goodViewModel = {
    counter: 0,
    selectedItems: ko.observableArray(),
    items: ko.observableArray()
};

goodViewModel.allSelected = ko.computed({
    read: function() {
        return goodViewModel.items().length === goodViewModel.selectedItems().length;
    },
    write: function(newValue) {
        if(newValue) {
            goodViewModel.selectedItems(goodViewModel.items().slice(0)); // Need a copy!
        } else {
            goodViewModel.selectedItems.removeAll();
        }
    }
});

goodViewModel.numberSelected = ko.computed(function() {
    return goodViewModel.selectedItems().length;
});

goodViewModel.add = function() {
    var item = { body: goodViewModel.counter++ }
    item.selected = ko.computed({
        read: function() {
            return goodViewModel.selectedItems.indexOf(item) > -1;
        },
        write: function(newValue) {
            if(newValue) {
                goodViewModel.selectedItems.push(item);
            } else {
                goodViewModel.selectedItems.remove(item);
            }
        }
    });
    goodViewModel.items.push(item);
};

ko.applyBindings(badViewModel, document.getElementById('#badExample'));
ko.applyBindings(goodViewModel, document.getElementById('#goodExample'));
</script>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            May  5, 2016 20:38 UTC
            
            (Last updated on May  9, 2018 00:51 UTC)

            
                Tags: <a href="./tags/javascript.html">javascript</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/understanding-typing-judgments.html">Understanding typing judgments</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="EE49D35E-A547-46A0-86F3-9419AFCEA309" href="./posts/understanding-typing-judgments.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <h3 id="introduction">Introduction</h3>
<p>For many people interested in type systems and type theory, their first encounter with the literature presents them with this:</p>
<p><code class="asciimath">#frac(Gamma,x:tau_1 |--_Sigma e : tau_2)(Gamma |--_Sigma (lambda x:tau_1.e) : tau_1 -&gt; tau_2) -&gt;I#</code></p>
<p><code class="asciimath">#frac(Gamma |--_Sigma f : tau_1 -&gt; tau_2 \qquad Gamma |--_Sigma x : tau_1)(Gamma |--_Sigma f x : tau_2) -&gt;E#</code></p>
<p>Since this notation is ubiquitous, authors (reasonably) expect readers to already be familiar with it and thus provide no explanation. Because the notation is ubiquitous, the beginner looking for alternate resources will not escape it. All they will find is that the notation is everywhere but exists in myriad minor variations which may or may not indicate significant differences. At this point the options are: 1) to muddle on and hope understanding the notation isn’t too important, 2) look for introductory resources which typically take the form of $50+ 500+ page textbooks, or 3) give up.</p>
<p>The goal of this article is to explain the notation part-by-part in common realizations, and to cover the main idea behind the notation which is the idea of an inductively defined relation. To eliminate ambiguity and make hand-waving impossible, I’ll ground the explanations in code, in particular, in <a href="http://wiki.portal.chalmers.se/agda/pmwiki.php">Agda</a>. That means for each example of the informal notation, there will be how it would be realized in Agda.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> It will become clear that I’m am not (just) using Agda as a formal notation to talk about these concepts, but that Agda’s<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> data type mechanism directly captures them<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. The significance of this is that programmers are already familiar with many of the ideas behind the informal notation, and the notation is just obscuring this familiarity. Admittedly, Agda is itself pretty intimidating. I hope most of this article is accessible to those with familiarity with algebraic data types as they appear in Haskell, ML, Rust, or Swift with little to no need to look up details about Agda. Nevertheless, Agda at least has the benefit, when compared to the informal notation, of having a clear place to go to learn more, an unambiguous meaning, and tools that allow playing around with the ideas.</p>

            <h6><a href="./posts/understanding-typing-judgments.html">Read more...</a></h6>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            April 13, 2016 02:41 UTC
            
            (Last updated on November 10, 2016 08:03 UTC)

            
                Tags: <a href="./tags/Agda.html">Agda</a>, <a href="./tags/type%20theory.html">type theory</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->



    <div class="blog-post teaser panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-title"><a href="./posts/high-dimensional-thought-experiment.html">High dimensional thought experiment from Hamming</a></h2>
        <h6 class="pull-right" style="margin-top: -1.5ex"><a data-disqus-identifier="8CBD9E89-9943-45CA-9E5A-9CF2C04E5393" href="./posts/high-dimensional-thought-experiment.html#disqus_thread"></a></h6>
    </div>

    <div class="panel-body">
        
            <p>This is a simple mathematical thought experiment from Richard Hamming to demonstrate how poor our intuition for high dimensional spaces is. All that is needed is some basic, middle school level geometry and algebra.</p>
<p>Consider a 2x2 square centered at the origin. In each quadrant place circles as big as possible so that they fit in the square and don’t overlap. They’ll clearly have radius 1/2. See the image below. The question now is what’s the radius of the largest circle centered at the origin that doesn’t overlap the other circles.</p>
<p><img src="./posts/raw/high-dimensional-diagram.svg" alt /></p>
<p>It’s clear from symmetry that the inner circle is going to touch all the other circles at the same time, and it is clear that it is going to touch along the line from the origin to the center of one of the outer circles. So the radius of the inner circle, #r#, is just the distance from the origin to the center of one of the outer circles minus the radius of the outer circle, namely 1/2. As an equation:</p>
<p><code class="asciimath">#r = sqrt(1/2^2 + 1/2^2) - 1/2 = sqrt(2)/2 - 1/2 ~~ 0.207106781#</code></p>
<p>Now if we go to three dimensions we’ll have eight circles instead of four, but everything else is the same except the distances will now be <code class="asciimath">#sqrt(1/2^2 + 1/2^2 + 1/2^2)#</code>. It’s clear that the only difference for varying dimensions is that in dimension #n# we’ll have #n# #1/2^2# terms under the square root sign. So the general solution is easily shown to be:</p>
<p><code class="asciimath">#r = sqrt(n)/2 - 1/2#</code></p>
<p>You should be weirded out now. If you aren’t, here’s a hint: what happens when #n = 10#? Here’s another hint: what happens as #n# approaches #oo#?</p>
<p>3blue1brown has a <a href="https://www.youtube.com/watch?v=zwAD6dRSVyI">video</a> describing this example and presenting one way of regaining intuition about it.</p>
        
    </div>

    <div class="panel-footer">
        <h6 class="blog-post-meta">
            December  4, 2015 01:22 UTC
            
            (Last updated on August 13, 2017 06:40 UTC)

            
                Tags: <a href="./tags/math.html">math</a>
            
        </h6>
    </div>

</div><!-- /.blog-post -->




        </div><!-- /.blog-main -->
        
            <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
              
              <div class="sidebar-module panel panel-default" style="padding: 0;">
                <div class="panel-heading"><h4>Recent</h4></div>
                <div class="panel-body">
                    <ol class="list-unstyled">
                        
                          <li><div class="blog-post-link">2018-03-26 - <a href="./posts/finite.html">Finite</a></div></li>
                        
                          <li><div class="blog-post-link">2018-03-01 - <a href="./posts/the-pedagogy-of-logic-a-rant.html">The Pedagogy of Logic: A Rant</a></div></li>
                        
                          <li><div class="blog-post-link">2017-04-09 - <a href="./posts/djinn.html">Djinn in your browser</a></div></li>
                        
                          <li><div class="blog-post-link">2016-11-25 - <a href="./posts/category-theory-syntactically.html">Category Theory, Syntactically</a></div></li>
                        
                          <li><div class="blog-post-link">2016-11-10 - <a href="./posts/find-first-set.html">Constant-time Binary Logarithm</a></div></li>
                        
                          <li><div class="blog-post-link">2016-09-23 - <a href="./posts/quotient-types-for-programmers.html">Quotient Types for Programmers</a></div></li>
                        
                          <li><div class="blog-post-link">2016-05-07 - <a href="./posts/constructivist-motto.html">Constructivist Motto</a></div></li>
                        
                          <li><div class="blog-post-link">2016-05-05 - <a href="./posts/the-mistake-everyone-makes-with-knockoutjs.html">The Mistake Everyone Makes with KnockoutJS</a></div></li>
                        
                          <li><div class="blog-post-link">2016-04-13 - <a href="./posts/understanding-typing-judgments.html">Understanding typing judgments</a></div></li>
                        
                          <li><div class="blog-post-link">2015-12-04 - <a href="./posts/high-dimensional-thought-experiment.html">High dimensional thought experiment from Hamming</a></div></li>
                        
                    </ol>
                </div>
              </div>
              <div class="sidebar-module panel panel-default" style="padding: 0;">
                <div class="panel-heading"><h4>Tags</h4></div>
                <div class="panel-body">
                    <ol class="list-unstyled">
                      <li><a href="./tags/Agda.html">Agda (1)</a></li>
<li><a href="./tags/CS.html">CS (3)</a></li>
<li><a href="./tags/category%20theory.html">category theory (3)</a></li>
<li><a href="./tags/geometric%20algebra.html">geometric algebra (1)</a></li>
<li><a href="./tags/javascript.html">javascript (1)</a></li>
<li><a href="./tags/logic.html">logic (2)</a></li>
<li><a href="./tags/math.html">math (9)</a></li>
<li><a href="./tags/programming.html">programming (2)</a></li>
<li><a href="./tags/type%20theory.html">type theory (2)</a></li>
                    </ol>
                </div>
              </div>
            </div><!-- /.blog-sidebar -->
        
      </div><!-- /.row -->
    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>Site generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a></p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" integrity="sha384-6ePHh72Rl3hKio4HiJ841psfsRJveeS+aLoaEf3BWfS+gTF0XdAqku2ka8VddikM" crossorigin="anonymous"></script>
    <script src="./js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->
    <script type="text/javascript">
        var disqus_shortname = 'hedonisticlearning';
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML.js" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous">
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          extensions: ['asciimath2jax.js'],
          asciimath2jax: {
              delimiters: [['#','#']],
              processClass: 'asciimath'
          },
          tex2jax: {
              inlineMath: [['|','|']]
          }
        });
    </script>
  </body>
</html>
